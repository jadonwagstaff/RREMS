#! /usr/bin/awk -f

# Makes a bed file from .cov file with color corresponding to percent
# methylation
# ==============================================================================
# Color is scico roma going from blue (0) to red (100) generated with the
# following R code:
#
# ramp <- grDevices::colorRampPalette(
#   c("deepskyblue4", "mediumpurple1", "firebrick2"),
#   interpolate = "spline")
# color <- col2rgb(ramp(101))
# color <- apply(color, 2, function(x) paste(x[1], x[2], x[3], sep = ","))
#
# for (i in 1:length(color)) {
#   cat("color[\"", i - 1, "\"] = \"",  color[i], "\"\n",  sep = "")
# }
# ==============================================================================
# Parameters:
#   .cov file
#   sample = name of sample
# ==============================================================================
# Example:
#   awk -v name="myfilename" -f colorbed.awk myfile.cov > myfile.bed
# ==============================================================================

BEGIN {
    FS = "\t";
    OFS = "\t";
    print "track name=\""name"\" itemRgb=\"On\"";
    
    color["0"] = "0,104,139"
    color["1"] = "4,105,144"
    color["2"] = "8,107,149"
    color["3"] = "13,108,155"
    color["4"] = "17,110,160"
    color["5"] = "21,111,165"
    color["6"] = "26,113,170"
    color["7"] = "30,114,174"
    color["8"] = "34,115,179"
    color["9"] = "38,116,184"
    color["10"] = "42,118,188"
    color["11"] = "46,119,192"
    color["12"] = "50,120,196"
    color["13"] = "54,121,200"
    color["14"] = "58,122,204"
    color["15"] = "62,123,208"
    color["16"] = "66,124,211"
    color["17"] = "69,125,215"
    color["18"] = "73,126,218"
    color["19"] = "77,127,221"
    color["20"] = "80,127,224"
    color["21"] = "84,128,227"
    color["22"] = "88,129,230"
    color["23"] = "91,129,232"
    color["24"] = "95,130,235"
    color["25"] = "98,131,237"
    color["26"] = "101,131,240"
    color["27"] = "105,131,242"
    color["28"] = "108,132,244"
    color["29"] = "111,132,246"
    color["30"] = "115,133,247"
    color["31"] = "118,133,249"
    color["32"] = "121,133,250"
    color["33"] = "124,133,252"
    color["34"] = "127,133,253"
    color["35"] = "130,133,254"
    color["36"] = "133,134,255"
    color["37"] = "136,134,255"
    color["38"] = "139,133,255"
    color["39"] = "142,133,255"
    color["40"] = "145,133,255"
    color["41"] = "147,133,255"
    color["42"] = "150,133,255"
    color["43"] = "153,133,255"
    color["44"] = "155,132,255"
    color["45"] = "158,132,255"
    color["46"] = "161,132,255"
    color["47"] = "163,131,255"
    color["48"] = "166,131,255"
    color["49"] = "168,130,255"
    color["50"] = "171,130,255"
    color["51"] = "173,129,253"
    color["52"] = "175,128,252"
    color["53"] = "177,127,251"
    color["54"] = "180,127,250"
    color["55"] = "182,126,248"
    color["56"] = "184,125,246"
    color["57"] = "186,124,245"
    color["58"] = "188,123,243"
    color["59"] = "190,122,241"
    color["60"] = "192,121,238"
    color["61"] = "194,120,236"
    color["62"] = "196,119,234"
    color["63"] = "198,118,231"
    color["64"] = "200,117,228"
    color["65"] = "202,115,226"
    color["66"] = "203,114,223"
    color["67"] = "205,113,219"
    color["68"] = "207,111,216"
    color["69"] = "208,110,213"
    color["70"] = "210,109,209"
    color["71"] = "211,107,206"
    color["72"] = "213,105,202"
    color["73"] = "214,104,198"
    color["74"] = "216,102,194"
    color["75"] = "217,101,190"
    color["76"] = "218,99,186"
    color["77"] = "220,97,181"
    color["78"] = "221,95,177"
    color["79"] = "222,93,172"
    color["80"] = "223,91,167"
    color["81"] = "224,89,162"
    color["82"] = "225,87,157"
    color["83"] = "226,85,152"
    color["84"] = "227,83,147"
    color["85"] = "228,81,141"
    color["86"] = "229,79,136"
    color["87"] = "230,77,130"
    color["88"] = "231,74,124"
    color["89"] = "232,72,118"
    color["90"] = "232,70,112"
    color["91"] = "233,67,106"
    color["92"] = "234,65,99"
    color["93"] = "234,62,93"
    color["94"] = "235,60,86"
    color["95"] = "235,57,79"
    color["96"] = "236,55,72"
    color["97"] = "236,52,65"
    color["98"] = "237,49,58"
    color["99"] = "237,46,51"
    color["100"] = "238,44,44"
} {
    print $1, $2, $3, # location
        $1":"$2"-"$3, # name
        int($4 * 100), # percent methylated
        "+",
        $2, $3, # rectangle location
        color[int($4 * 100)] # color value
}
